<html>
<head>
	<!-- these 4 files always have to be included -->
	<link rel="stylesheet" type="text/css" href="../../lib/css/materialize.css">
	<link rel="stylesheet" type="text/css" href="../../css/adapter.css"/>

	<script type="text/javascript" src="../../lib/js/jquery-3.2.1.min.js"></script>
	<script type="text/javascript" src="../../socket.io/socket.io.js"></script>

	<!-- these files always have to be included -->
	<script type="text/javascript" src="../../js/translate.js"></script>
	<script type="text/javascript" src="../../lib/js/materialize.js"></script>
	<script type="text/javascript" src="../../js/adapter-settings.js"></script>
	
	<script type="text/javascript" src="https://cdn.rawgit.com/showdownjs/showdown/1.9.0/dist/showdown.min.js"></script>
	<script type="text/javascript" src="words.js"></script>
	<script type="text/javascript">
    var onChange;
	var settings = {
		decode: {
			key: 'kolNIO(Z23d$', // used for encrypted password
			fields: ['']
		}
	}
	
	/*
	 * PAGE LOADED
	 */
	$(window).on('load', function()
	{
		M.Tabs.init($('.tabs'));
		M.Modal.init($('#modal'));
		
		var cid = $('#client_id');
		var csecret = $('#client_secret');
		var getToken = $('#button_getToken');
		var generateToken = $('#button_generateToken');
		var secure = $('#secure');
		
		/*
		 * Get Alexa Tutorials
		 */
		var strStart = '## Smart Home / Alexa integration using ioBroker.javascript';
		var strEnd = '\n## ';
		
		$.get('https://raw.githubusercontent.com/Zefau/ioBroker.nello/master/README.md', function(data)
		{
			var intStart = data.indexOf(strStart);
			var intEnd = data.indexOf(strEnd, intStart + strStart.length);
			
			var converter = new showdown.Converter();
			$('#alexaIntegration').html(converter.makeHtml(data.slice(intStart, intEnd)));
		});
		
		/*
		 * Checkbox
		 */
		function showHideSettings(state) {$('.hideCol').toggleClass('hidden', state)}
		secure.on('change', function() {showHideSettings(!$(this).prop('checked'))});
		
		/*
		 * Get token
		 */
		getToken.on('click', function()
		{
			$('#statusLog').text('');
			var modal = M.Modal.getInstance($('#modal'));
			modal.open();
		});
		
		/*
		 * Generate token
		 */
		generateToken.on('click', function()
		{
			$('#log').html('');
			
			// client id and secret given
			if (cid.val() && csecret.val())
			{
				log(translateWord('message_connecting'));
				
				// cancel
				var timeout = setTimeout(function() {log(translateWord('message_noconnection'), 'error');}, 7000);
				
				// send request
				sendTo(null, 'setToken', {clientId: cid.val(), clientSecret: csecret.val()}, function(res)
				{
					log(translateWord('message_connected'));
					clearTimeout(timeout);
					
					if (res !== false && res.result !== false)
					{
						$('#token_type, #token_type-existing').val(res.type).focus();
						$('#access_token, #access_token-existing').val(res.access).focus();
						$('#access_token').trigger('change');
						
						var modal = M.Modal.getInstance($('#modal'));
						modal.close();
					}
					else
						log(res.error !== undefined ? res.error : translateWord('message_error-token'), 'error');
				});
			}
			else
				log(translateWord('message_missing-clientid'), 'error');
		});
	});
	</script>
	<script type="text/javascript" src="admin.js"></script>
	
	<link rel="stylesheet" href="github-markdown.css" />
	<style>
		.m select {display: block !important}
		.hidden {display: none}
		.box {
			padding-top: 5px !important;
			margin: 0 !important;
			background-color: #fff; /*#acd8fa*/
		}
		
		#log {
			background-color: #fff;
			padding: 20px 30px;
		}
		.log {display: block}
		.log.error {color: #a00}
		.log.success {color: #0a0}
		.log.info {color: #00a}
		
		img {margin: 5px}
		a.active {font-weight: bold}
		p.title {margin-bottom: 0}
		p.subtitle {padding: 0 .75rem}
		p.errorMessage {
			padding: 5px;
			color: #c00;
		}
	</style>
</head>
<body>


<div class="m adapter-container" id="settings">
	
	<!-- Modal Structure -->
	<div id="modal" class="modal">
		<div class="modal-content">
			<strong class="translate">button_getToken</strong><br />
			<p class="translate">token_APIinfo</p>
			<p class="translate">token_fillInClientId</p>
			
			<div class="row">
				<div class="input-field col s6 m6">
					<input id="client_id" type="text"/>
					<label for="client_id" class="translate">client_id</label>
				</div>
				<div class="input-field col s6 m6">
					<input id="client_secret" type="text" />
					<label for="client_secret" class="translate">client_secret</label>
				</div>
			</div>
			<div class="row">
				<div class="col s12 m12">
					<strong style="font-weight: bold">Status:</strong>
					<div id="log"></div>
				</div>
			</div>
			
		</div>
		<div class="modal-footer">
			<a href="#!" class="modal-close waves-effect waves-green btn-flat translate">button_closeModal</a>
			<a href="#!" class="btn green translate" id="button_generateToken">button_getToken</a>
		</div>
	</div>
	
	<div class="row">
		
		<!-- TABS -->
		<div class="col s12">
			<ul class="tabs">
				<li class="tab col s3"><a class="translate active" href="#config">tab_config</a></li>
				<li class="tab col s3"><a class="translate" href="#alexa">tab_alexa</a></li>
				<li class="tab col s3"><a class="translate" href="#info">tab_info</a></li>
			</ul>
		</div>
		
		<!-- CONFIG -->
		<div id="config" class="col s12">
			
			<!-- Token -->
			<div class="row">
				<div class="col s12 m12 page">
					<div class="row" style="margin-bottom: 0">
						<div class="col s12 m12">
							<p class="translate title">auth</p>
						</div>
					</div>
					<div class="row box">
						<p class="subtitle translate">token_fillin</p>
						
						<div class="input-field col s5 m5">
							<input class="value" id="token_type" type="text" />
							<label for="token_type" class="translate">token_type</label>
						</div>
						<div class="input-field col s5 m5">
							<input class="value" id="access_token" type="text" />
							<label for="access_token" class="translate">access_token</label>
						</div>
						<div class="input-field col s2 m2 center">
							<a class="btn red translate" id="button_getToken">button_getToken</a>
						</div>
					</div>
					
				</div>
			</div>
			
			<!-- Events -->
			<div class="row">
				<div class="col s12 m12 page">
					<div class="row" style="margin-bottom: 0">
						<div class="col s12 m12">
							<p class="translate title">events</p>
						</div>
					</div>
					<div class="row box">
						<p class="subtitle translate">events_info</p>
						
						<div class="input-field col s4 m4">
							<input class="value" id="uri" type="text" placeholder="www.domain.com:1234" />
							<label for="uri" class="translate">uri</label>
						</div>
						
						<div class="input-field col s2 m2">
							<div class="row">
								<div class="col">
									<label for="secure">
										<input class="value" id="secure" type="checkbox" />
										<span class="translate">ssl</span>
									</label>
								</div>
							</div>
							<div class="row">
								<div class="col hideCol">
									<label for="selfSigned">
										<input class="value" id="selfSigned" type="checkbox" />
										<span class="translate">selfSigned</span>
									</label>
								</div>
							</div>
						</div>
						<div class="col s2 m2 hideCol">
							<label class="translate" for="certPublic">public</label>
							<select id="certPublic" class="value" data-select="certificate" data-type="public"></select>
						</div>
						<div class="col s2 m2 hideCol">
							<label class="translate" for="certPrivate">private</label>
							<select id="certPrivate" class="value" data-select="certificate" data-type="private"></select>
						</div>
						<div class="col s2 m2 hideCol">
							<label class="translate" for="certChained">chained</label>
							<select id="certChained" class="value" data-select="certificate" data-type="chained"></select>
						</div>
					</div>
				</div>
			</div>
			
		</div>
		
		<!-- ALEXA -->
		<div id="alexa" class="col s12">
			
			<div class="row">
				<div class="col s12 m12 page">
					<div class="row box">
						<div class="col s12 m12">
							<div class="markdown-body" id="alexaIntegration"></div>
						</div>
					</div>
					
				</div>
			</div>
			
		</div>
		
		<!-- INFO -->
		<div id="info" class="col s12">
			
			<div class="row">
				<div class="col s12 m12 page">
					<div class="row box">
						<div class="col s12 m12">
							<a target="_blank" href="https://www.npmjs.com/package/iobroker.nello">
								<img src="https://camo.githubusercontent.com/d1d9548f021f712a2838de2229b6ed3deb95b504/68747470733a2f2f6e6f6465692e636f2f6e706d2f696f62726f6b65722e6e656c6c6f2e706e673f646f776e6c6f6164733d74727565" />
							</a>
							<br />
							
							<img src="https://camo.githubusercontent.com/416f011b2ea9c9180638ce851126d72b8d7700e7/687474703a2f2f696d672e736869656c64732e696f2f6e706d2f762f696f62726f6b65722e6e656c6c6f2e737667" />
							<img src="https://camo.githubusercontent.com/f3384c5a305415756b92302e6df1f5acb8d526e7/68747470733a2f2f696d672e736869656c64732e696f2f6e706d2f646d2f696f62726f6b65722e6e656c6c6f2e737667" />
							<br />
							
							<ul>
								<li>For setup instructions please <a target="_blank" href="https://github.com/Zefau/ioBroker.nello#setup-instructions-english">see manual on Github</a>.</li>
								<li>For smart home / alexa integration please <a target="_blank" href="https://github.com/Zefau/ioBroker.nello#smart-home--alexa-integration-using-iobrokerjavascript">see ideas on Github</a>.</li>
								<li>If you experience issues please <a target="_blank" href="https://github.com/Zefau/ioBroker.nello/issues">submit a ticket on Github</a> or <a target="_blank" href="https://forum.iobroker.net/viewtopic.php?f=35&t=12835">ask on the ioBroker forum</a>.</li>
							</ul>
						</div>
					</div>
					
				</div>
			</div>
			
		</div>
		
	</div>

</div>

</body>
</html>
